<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>3D Interactive Image Drag & Drop</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    overflow: hidden;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    perspective: 1200px;
    font-family: 'Segoe UI', sans-serif;
    color: #fff;
  }

  .scene {
    width: 50%;
    height: 90%;
    position: relative;
    transform-style: preserve-3d;
    cursor: default;
    z-index: 1;
    background: transparent;
    border-radius: 20px;
    transition: outline 0.2s ease, transform 0.2s ease;
  }

  .scene.dragover {
    outline: 3px dashed #0f0;
  }

  .scene.dragging img {
    animation: shake 0.3s infinite;
  }

  @keyframes shake {
    0% { transform: rotateX(0deg) rotateY(0deg) translateZ(0) scale(1); }
    25% { transform: rotateX(2deg) rotateY(-2deg) translateZ(0) scale(1.02); }
    50% { transform: rotateX(-2deg) rotateY(2deg) translateZ(0) scale(1.01); }
    75% { transform: rotateX(1deg) rotateY(-1deg) translateZ(0) scale(1.02); }
    100% { transform: rotateX(0deg) rotateY(0deg) translateZ(0) scale(1); }
  }

  .scene img {
    width: auto;
    height: 100%;
    object-fit: contain;
    background-color: transparent;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    transform: rotateX(0deg) rotateY(0deg) translateZ(0px) scale(1);
    transition: transform 0.1s ease, filter 0.3s ease;
    filter: brightness(1) blur(0px);
    user-select: none;
    pointer-events: none;
    position: relative;
  }

  .control-card {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255,255,255,0.1);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.4);
    width: 260px;
    z-index: 9999;
  }

  .control-card h3 { margin-top:0; font-size:1.1em; text-align:center; }

  .control { margin-bottom:12px; }
  .control label { font-size:0.9em; display:block; margin-bottom:4px; }
  .control input[type='range'], .control select, .control input[type='color'] { width:100%; }

  .toggle-group { display:flex; justify-content:space-between; gap:6px; }
  .toggle-group button {
    flex:1;
    padding:6px 0;
    border:none;
    border-radius:6px;
    background: rgba(255,255,255,0.15);
    color:#fff;
    cursor:pointer;
    transition:0.2s;
  }
  .toggle-group button.active { background:#0f0; color:#000; }

  .image-info {
    font-size:0.8em;
    background: rgba(0,0,0,0.3);
    padding:4px 6px;
    border-radius:6px;
    margin-top:6px;
    text-align:center;
    word-break: break-word;
  }

  .btn-group { display:flex; justify-content:space-between; gap:6px; margin-top:6px; }
  .btn-group button {
    flex:1;
    padding:6px 0;
    border:none;
    border-radius:6px;
    background: rgba(255,255,255,0.15);
    color:#fff;
    cursor:pointer;
    transition:0.2s;
  }
  .btn-group button:hover { background:#0f0; color:#000; }
</style>
</head>
<body>
<div class="scene" id="scene">
  <img id="bgImage" src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1000&q=80" alt="3D Image" draggable="false" />
</div>

<div class="control-card">
  <h3>Image Controls</h3>

  <div class="control"><label for="translateZ">Depth (Z)</label><input type="range" id="translateZ" min="0" max="200" value="0"></div>
  <div class="control"><label for="scale">Scale</label><input type="range" id="scale" min="0.5" max="2" step="0.01" value="1"></div>
  <div class="control"><label for="blur">Blur</label><input type="range" id="blur" min="0" max="10" step="0.1" value="0"></div>
  <div class="control"><label for="brightness">Brightness</label><input type="range" id="brightness" min="0.5" max="2" step="0.01" value="1"></div>

  <div class="control">
    <label>Image Fit</label>
    <div class="toggle-group" id="fitToggle">
      <button data-fit="contain" class="active">Contain</button>
      <button data-fit="cover">Cover</button>
    </div>
  </div>

  <div class="control">
    <label for="filterPreset">Filter Preset</label>
    <select id="filterPreset">
      <option value="normal">Normal</option>
      <option value="grayscale">Grayscale</option>
      <option value="warm">Warm</option>
      <option value="cool">Cool</option>
      <option value="sepia">Sepia</option>
    </select>
  </div>

  <div class="control">
    <label for="imageTint">Image Tint</label>
    <input type="color" id="imageTint" value="#ffffff">
  </div>

  <div class="control image-info" id="imageInfo">이미지 업로드가 필요합니다.</div>

  <div class="btn-group">
    <button id="cancelImage">취소</button>
    <button id="downloadImage">다운로드</button>
  </div>
</div>

<script>
const img = document.getElementById('bgImage');
const scene = document.getElementById('scene');
const translateZ = document.getElementById('translateZ');
const scale = document.getElementById('scale');
const blur = document.getElementById('blur');
const brightness = document.getElementById('brightness');
const fitToggle = document.getElementById('fitToggle');
const filterPreset = document.getElementById('filterPreset');
const imageTint = document.getElementById('imageTint');
const imageInfo = document.getElementById('imageInfo');
const cancelImage = document.getElementById('cancelImage');
const downloadImage = document.getElementById('downloadImage');

let currentImageSrc = img.src;

// 마우스 기반 회전
function updateTransform(mouseX=0, mouseY=0) {
  const centerX = window.innerWidth/2;
  const centerY = window.innerHeight/2;

  const deltaX = mouseX - centerX;
  const deltaY = mouseY - centerY;

  const rotY = deltaX * 0.02;
  const rotX = -deltaY * 0.02;

  img.style.transform = `rotateX(${rotX}deg) rotateY(${rotY}deg) translateZ(${translateZ.value}px) scale(${scale.value})`;
}

// 필터 + 색상 적용
function applyFilter() {
  let filter = `blur(${blur.value}px) brightness(${brightness.value})`;
  const tintColor = imageTint.value;
  filter += ` drop-shadow(0 0 0 ${tintColor})`;

  switch(filterPreset.value){
    case 'grayscale': filter+=' grayscale(1)'; break;
    case 'warm': filter+=' sepia(0.3) saturate(1.3)'; break;
    case 'cool': filter+=' contrast(1.1) hue-rotate(180deg)'; break;
    case 'sepia': filter+=' sepia(1)'; break;
  }
  img.style.filter = filter;
}

// 슬라이더 이벤트
document.querySelectorAll('.control input[type="range"]').forEach(input=>{
  input.addEventListener('input', ()=>updateTransform());
});
fitToggle.querySelectorAll('button').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    fitToggle.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    img.style.objectFit = btn.dataset.fit;
  });
});

// 이미지 취소/다운로드
cancelImage.addEventListener('click', ()=>{
  img.src = currentImageSrc;
  imageInfo.textContent = '이미지 업로드가 필요합니다.';
});
downloadImage.addEventListener('click', ()=>{
  const link = document.createElement('a');
  link.href = img.src;
  link.download = 'image.png';
  link.click();
});

// 드래그앤드롭 업로드 + 효과
document.body.addEventListener('dragover', e=>{
  e.preventDefault();
  scene.classList.add('dragover', 'dragging');
});
document.body.addEventListener('dragleave', e=>{
  e.preventDefault();
  scene.classList.remove('dragover', 'dragging');
});
document.body.addEventListener('drop', e=>{
  e.preventDefault();
  scene.classList.remove('dragover', 'dragging');

  const file = e.dataTransfer.files[0];
  if(file && file.type.startsWith('image/')){
    const reader = new FileReader();
    reader.onload = function(event){
      img.src = event.target.result;
      imageInfo.textContent = `업로드됨: ${file.name} (${Math.round(file.size/1024)} KB)`;

      // 드롭 시 확대 애니메이션
      img.style.transition = 'transform 0.2s ease, filter 0.3s ease';
      img.style.transform += ' scale(1.05)';
      setTimeout(()=>updateTransform(), 200);
    };
    reader.readAsDataURL(file);
  } else {
    imageInfo.textContent = '이미지 파일만 올릴 수 있습니다.';
  }
});

// 마우스 이동 회전
document.addEventListener('mousemove', e=>{
  updateTransform(e.clientX, e.clientY);
});
</script>
</body>
</html>
